# @package _global_
defaults:
  - example.yaml
  - override /resources: pack_jobs.yaml
  - override /trainer/logger: wandb
  - override /hydra/launcher: custom_submitit_slurm

name: custom_launcher_debug
seed: ${oc.env:SLURM_PROCID,123}
log_level: DEBUG

trainer:
  accelerator: gpu
  devices: 1
  max_epochs: 1
  logger:
    wandb:
      project: "ResearchTemplate"
      # TODO: Use the Orion trial name?
      name: ${oc.env:SLURM_JOB_ID}_${oc.env:SLURM_PROCID}
      save_dir: "${hydra:runtime.output_dir}"
      offline: False # set True to store all logs only locally
      id: null # pass correct id to resume experiment!
      # entity: ""  # set to name of your wandb team
      log_model: False
      prefix: ""
      job_type: "train"
      group: ${oc.env:SLURM_JOB_ID}
      # tags: ["${name}"]

hydra:
  mode: MULTIRUN
  verbose: True
  run:
    # NOTE: Unsure if this gets used, since we hard-set the `MULTIRUN` mode.
    dir: logs/${name}/runs/${now:%Y-%m-%d}/${now:%H-%M-%S}/task{oc.env:SLURM_PROCID}
  #   # output directory, generated dynamically on each run
  #   subdir: ${oc.env:SLURM_PROCID,}  # NOTE: Can't add this here unfortunately.
  sweep:
    dir: logs/${name}/multiruns/${now:%Y-%m-%d}/${now:%H-%M-%S}
    subdir: ${hydra.job.id}_task${oc.env:SLURM_PROCID}

  # TODO: Try to make it so the .submitit stuff is in the same folder as the checkpoints and
  # everything else...
  launcher:
    submitit_folder: "${hydra.sweep.dir}/%j"
